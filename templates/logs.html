<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FraudShield — Analysis Logs</title>
  <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='favicon.svg') }}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=IBM+Plex+Mono:wght@300;400;500&family=Barlow:wght@300;400;500;600&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script>
    (function () {
      var t = localStorage.getItem('fraudshield-theme');
      if (t === 'light') document.documentElement.setAttribute('data-theme', 'light');
    })();
  </script>
</head>

<body>
  <div class="scanline"></div>
  <div class="noise"></div>

  <header>
    <div class="header-left">
      <div class="logo">
        <svg class="logo-svg" viewBox="0 0 40 40" fill="none">
          <polygon points="20,2 38,12 38,28 20,38 2,28 2,12" stroke="#f5a623" stroke-width="1.5" fill="none" />
          <polygon points="20,8 32,15 32,25 20,32 8,25 8,15" stroke="#f5a623" stroke-width="1"
            fill="rgba(245,166,35,0.08)" />
          <circle cx="20" cy="20" r="4" fill="#f5a623" />
        </svg>
        <div class="logo-text">
          <span class="logo-name">FRAUDSHIELD</span>
          <span class="logo-sub">THREAT INTELLIGENCE SYSTEM v2.4</span>
        </div>
      </div>
    </div>
    <div class="header-right">
      <div class="status-item">
        <span class="status-dot pulse"></span>
        <span class="status-label">SYSTEM ONLINE</span>
      </div>
      <nav class="header-nav">
        <a href="/" class="nav-link mono">ANALYZE</a>
        <a href="/#awareness" class="nav-link mono">AWARENESS</a>
        <a href="/logs" class="nav-link mono active">LOGS</a>
        <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()" title="Toggle light/dark mode">
          <svg class="theme-icon sun" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="5" />
            <line x1="12" y1="1" x2="12" y2="3" />
            <line x1="12" y1="21" x2="12" y2="23" />
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
            <line x1="1" y1="12" x2="3" y2="12" />
            <line x1="21" y1="12" x2="23" y2="12" />
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
          </svg>
          <svg class="theme-icon moon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" />
          </svg>
        </button>
      </nav>
    </div>
  </header>

  <div class="ticker-wrap">
    <div class="ticker-track">
      <span>DATABASE: SQLITE ACTIVE</span><span class="sep">///</span>
      <span>LOGGING: ENABLED</span><span class="sep">///</span>
      <span>TOTAL SCANS: {{ stats.total }}</span><span class="sep">///</span>
      <span>HIGH RISK DETECTED: {{ stats.high }}</span><span class="sep">///</span>
      <span>AVG THREAT SCORE: {{ stats.avg_score }}</span><span class="sep">///</span>
      <span>DATABASE: SQLITE ACTIVE</span><span class="sep">///</span>
      <span>LOGGING: ENABLED</span><span class="sep">///</span>
      <span>TOTAL SCANS: {{ stats.total }}</span><span class="sep">///</span>
      <span>HIGH RISK DETECTED: {{ stats.high }}</span><span class="sep">///</span>
      <span>AVG THREAT SCORE: {{ stats.avg_score }}</span><span class="sep">///</span>
    </div>
  </div>

  <main>
    <!-- PAGE TITLE -->
    <div class="logs-hero">
      <div class="hero-label mono">// ANALYSIS HISTORY DATABASE</div>
      <h1 class="hero-title" style="font-size: clamp(3rem,7vw,5.5rem);">SCAN <span class="outline-text">LOGS</span></h1>
    </div>

    <!-- STAT CARDS -->
    <div class="stat-cards">
      <div class="stat-card">
        <div class="stat-card-num">{{ stats.total }}</div>
        <div class="stat-card-label mono">TOTAL SCANS</div>
      </div>
      <div class="stat-card high-card">
        <div class="stat-card-num" style="color:var(--high)">{{ stats.high }}</div>
        <div class="stat-card-label mono">HIGH RISK</div>
      </div>
      <div class="stat-card medium-card">
        <div class="stat-card-num" style="color:var(--medium)">{{ stats.medium }}</div>
        <div class="stat-card-label mono">MEDIUM RISK</div>
      </div>
      <div class="stat-card low-card">
        <div class="stat-card-num" style="color:var(--low)">{{ stats.low }}</div>
        <div class="stat-card-label mono">LOW RISK</div>
      </div>
      <div class="stat-card">
        <div class="stat-card-num" style="color:var(--amber)">{{ stats.avg_score }}</div>
        <div class="stat-card-label mono">AVG SCORE</div>
      </div>
    </div>

    <!-- LOGS TABLE -->
    <div class="panel logs-panel">
      <div class="panel-header">
        <span class="panel-id mono">[ PANEL-LOG ]</span>
        <span class="panel-title">RECENT ANALYSIS RECORDS</span>
        <span class="panel-status mono">LAST 20 ENTRIES</span>
      </div>

      {% if logs %}
      <div class="logs-table-wrap">
        <table class="logs-table">
          <thead>
            <tr>
              <th class="mono">ID</th>
              <th class="mono">TIMESTAMP</th>
              <th class="mono">RISK</th>
              <th class="mono">FINAL</th>
              <th class="mono">RULE</th>
              <th class="mono">AI</th>
              <th class="mono">FLAGS</th>
              <th class="mono">MESSAGE PREVIEW</th>
            </tr>
          </thead>
          <tbody>
            {% for log in logs %}
            <tr class="log-row risk-row-{{ log.risk_level }}">
              <td class="mono muted">#{{ log.id }}</td>
              <td class="mono muted small">{{ log.analyzed_at }}</td>
              <td>
                <span class="risk-pill {{ log.risk_level }}">{{ log.risk_level }}</span>
              </td>
              <td class="mono score-cell final-{{ log.risk_level }}">{{ log.final_score }}</td>
              <td class="mono score-cell rule-col">{{ log.rule_score }}</td>
              <td class="mono score-cell ai-col">{{ log.ai_score }}</td>
              <td class="flags-cell">
                {% if log.flags %}
                {% for flag in log.flags.split(', ')[:3] %}
                <span class="mini-flag">{{ flag }}</span>
                {% endfor %}
                {% if log.flags.split(', ')|length > 3 %}
                <span class="mini-flag more">+{{ log.flags.split(', ')|length - 3 }}</span>
                {% endif %}
                {% else %}
                <span class="muted mono small">none</span>
                {% endif %}
              </td>
              <td class="preview-cell">{{ log.message[:80] }}{% if log.message|length > 80 %}…{% endif %}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <div class="empty-logs">
        <div class="empty-icon mono">[ NO RECORDS ]</div>
        <p>No messages have been analyzed yet. <a href="/" class="amber-link">Run your first scan →</a></p>
      </div>
      {% endif %}
    </div>

    <div class="action-row">
      <a href="/" class="reset-btn mono">↩ BACK TO ANALYZER</a>
      <div class="disclaimer mono">LOGS STORED LOCALLY IN SQLITE — NO DATA IS TRANSMITTED EXTERNALLY</div>
    </div>
  </main>

  <footer>
    <div class="footer-inner">
      <span class="mono">FRAUDSHIELD INTELLIGENCE SYSTEM</span>
      <span class="footer-sep">///</span>
      <span class="mono">DUAL-ENGINE DETECTION</span>
      <span class="footer-sep">///</span>
      <span class="mono">© 2025 — EDUCATIONAL USE ONLY</span>
    </div>
  </footer>
  <script src="{{ url_for('static', filename='theme.js') }}"></script>
</body>

</html>
